<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
    <meta charset="UTF-8">
    <title>개인 거래 상세페이지</title>
</head>
<style>
.add { display: block; }
.cancel { display: none;	}
</style>
<body onload="startPage();">
<script>
    function addHeart() {
        $.ajax({
			type : "POST",
			url : "/user/myPage/wishlist/add",
			data : {
				"itemId" : $('#itemId').val()
			},
			success : function(data) {
				if (data == true) {
                    $('.add').hide();

          	        $('.cancel').show();

                    wishlistCount += 1;
          	        $('#wishCount').text(wishlistCount);
				} else {
				    alert('로그인 후 이용해주세요.');
				}
			}
		})
    }

    function cancelHeart() {
        $.ajax({
			type : "POST",
			url : "/user/myPage/wishlist/delete",
			data : {
				"itemId" : $('#itemId').val()
			},
			success : function(data) {
				if (data == true) {
                    $('.cancel').hide();

          	        $('.add').show();

          	        wishlistCount -= 1;
          	        $('#wishCount').text(wishlistCount);
				}
			}
		})
    }
</script>
<script th:inline="javascript">
/*<![CDATA[*/
    var wishlistCount = /*[[${personalItem.wishCount}]]*/;
    function startPage() {
        var isExistWishlist = /*[[${isExistWish}]]*/;
        if (isExistWishlist == 0) {
            $('.cancel').hide();
            $('.add').show();
        } else {
            $('.add').hide();
            $('.cancel').show();
        }
    }
/*]]>*/
</script>
<div th:replace="fragments/bodyHeader :: bodyHeader" />

<input type="hidden" id="itemId" th:name="itemId" th:value="${personalItem.id}"/>

<img th:src="@{${personalItem.imgPath}}"/>
<h2><span th:text="${personalItem.title}"></span></h2><br>
<span th:text="${personalItem.price}"></span><br>
<textarea th:value="${personalItem.description}" th:text="${personalItem.description}"></textarea><br>
<span th:text="${personalItem.status}"></span><br>
<span th:text="${personalItem.nickName}"></span>
담은 인원 : <span id="wishCount" th:text="${personalItem.wishCount}"></span>

<div th:if="${userSession?.account}">
    <div th:if="${userSession.account.id} == ${personalItem.sellerId}">
        <a th:href="@{/user/myPage/sell/personal/update(itemId=${personalItem.id})}">
            <input type="button" value="수정"></a>
        <a th:href="@{/user/myPage/sell/personal/delete(itemId=${personalItem.id})}">
            <input type="button" value="삭제"></a>
    </div>
</div>

<div class="add" id="add">
    <img th:src="@{/images/hearts.png}" th:onclick="addHeart()" />
</div>
<div class="cancel" id="cancel">
    <img th:src="@{/images/heartFill.png}" th:onclick="cancelHeart()" />
</div>


</body>
</html>