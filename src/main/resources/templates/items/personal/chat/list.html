<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
    <meta charset="UTF-8">
    <title>쪽지함</title>
</head>
<body>
<style>
	table {
		border: 1px solid;
		border-collapse: collapse;
		width: 100%;
	}
	td {
		padding: 20px;
		border: 1px solid;
		width: 45%;
	}

	.received {
	    float: left;
	    width: 150px;
	    height: 50px;
	    border: 1px solid;
	    text-align:center;
	    line-height: 50px;
	}

	.sended {
	    float: left;
	    width: 150px;
	    height: 50px;
	    border: 1px solid;
	    text-align:center;
	    line-height: 50px;
	}

	.receive {
        display: block;
	}

	.send {
        display: none;
	}

	.received span {
        font-weight: bold;
    }

    .con:hover {
        background : #EAEAEA;
        font-weight: bold;
    }

    .pad {
        padding-left: 5px;
    }

    .message {
        width: 100%;
        padding: 15px;
        display: none;
    }

    .rig {
        text-align: right;
        padding-right: 15px;
    }

    .resBtn {
        text-align: right;
        padding-right: 15px;
        display: none;
    }
</style>

<script>

    function receivedList() {
        var receivedTextElement = document.getElementById("receivedText");
        receivedTextElement.style.fontWeight = "bold";
        var sendedTextElement = document.getElementById("sendedText");
        sendedTextElement.style.fontWeight = "normal";

        $('.send').hide();
        $('.receive').show();
    }

    function sendedList() {
        var sendedTextElement = document.getElementById("sendedText");
        sendedTextElement.style.fontWeight = "bold";
        var receivedTextElement = document.getElementById("receivedText");
        receivedTextElement.style.fontWeight = "normal";

        $('.receive').hide();
        $('.send').show();
    }

    function detailView(notesId) {
        $.ajax({
			type : "GET",
			url : "/personal/chat/detail",
			data : {
				"notesId" : notesId
			},
			success : function(data) {
			    var notes = data;

                var notesId = notes.notesId;
                var title = notes.title;
                var content = notes.content;
                var sendDate = notes.sendDate;
                var readDate = "수신일 : ";

                document.getElementById("notesId").value = notesId;
                document.getElementById("title").textContent = title;
                document.getElementById("content").textContent = content;
                document.getElementById("sendedAt").textContent = "발신일 : " + sendDate;

                if (notes.readedAt != null) {
                    readDate += notes.readDate;
                } else {
                    readDate += " - ";
                }
                document.getElementById("readedAt").textContent = readDate;
                if (notes.toSellerNickName != null) { // 내가 발신자인 쪽지
                    var sender = notes.toSellerNickName;
                    document.getElementById("sender").textContent = sender;

                    $('.resBtn').hide();
                }
                if (notes.fromAccountNickName != null) { // 내가 수신자인 쪽지
                    var receiver = notes.fromAccountNickName;
                    document.getElementById("sender").textContent = receiver;

                    // 받은 쪽지를 열람할 때만 답장 버튼 생성
                    $('.resBtn').show();
                }

                $('.message').show();
			}
		})
    }

    function responseChat() {
        var notesId = document.getElementById("notesId").value;
        alert(notesId);
    }
</script>


<div th:replace="fragments/bodyHeader :: bodyHeader" />
<h2>쪽지함</h2><hr>

<div id="received" class="received" onclick='receivedList()'>
    <span id="receivedText">받은 쪽지함</span>
</div>
<div id="sended" class="sended" onclick='sendedList()'>
    <span id="sendedText">보낸 쪽지함</span>
</div>

<table>
  <tr>
    <td style="vertical-align: top;">
        <div class="receive">
            <div class="con" th:each="note : ${receivedNotes}"
                 th:onclick="|javascript:detailView('${note.notesId}')|">
                <span class="pad" th:text="${note.title}"></span>
                <hr>
            </div>
        </div>

        <div class="send">
            <div class="con" th:each="note : ${sendedNotes}"
                th:onclick="|javascript:detailView('${note.notesId}')|">
                <span class="pad" th:text="${note.title}"></span>
                <hr>
            </div>
        </div>
    </td>

    <td>
        <div class="message">
            <input type="hidden" id="notesId" name="notesId">
            <h2><span id="title" style="font-weight: bold;"></span></h2>
            <div class="rig">
                <span id="sender"></span><br>
                <span id="sendedAt"></span><br>
                <span id="readedAt"></span>
            </div><hr>
            <span id="content"></span><br><br>
            <div class="resBtn">
                <input type="button" value="답장하기" onclick="responseChat()">
            </div>
        </div>
    </td>
  </tr>
</table>


</body>
</html>